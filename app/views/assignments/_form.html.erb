<%- content_for :document_ready do -%>
	<script type="text/javascript" charset="utf-8">
		$(function(){
			$("select#project").change(function(){
				var url = '<%= associated_tasks_path(:"search[project_id]" => "JTAG") %>';
				$.ajax({
					url:url.replace("JTAG", $(this).val()),
					dataType:'xml',
					success:function(xml){
						$('select#assignment_associated_task_id').html('');
						$(xml).find('associated-task').each(function(){
							$('select#assignment_associated_task_id').append(
								"<option value=" + $(this).children('id').text() + ">" + 
									$(this).find('task name').text() + 
								"</option>"
							);
						});
					}
				});
			});
		});
	</script>
<%- end -%>

<% form_for @assignment do |f| %>
  <%= f.error_messages %>
	<p>
		<%= label_tag :project %>:
		<%= select_tag :project, options_for_select(["Select A Project"] + @projects.sort_by{ |item| item.client_id }.map{ |item| ["#{item.name} (#{item.client.name})", item.id] }, :selected => @assignment.associated_task.try(:project_id)) %>
	</p>
	<p>
		<%= f.label :associated_task_id, "Task" %>: 
	  <%= f.collection_select :associated_task_id, @assignment.associated_task.try(:project).try(:associated_tasks) || [], :id, :name, {:disabled => true} %>
	</p>
  <p>
    <%= f.label :notes %><br />
    <%= f.text_area :notes, :col => 3, :rows => 3 %>
  </p>
  <p>
    <%= f.label :hours, "Hours:" %>
    <%= f.text_field :hours, :size => 3 %>
  </p>
  <p><%= f.submit "Submit" %></p>
<% end %>
